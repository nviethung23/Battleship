<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battleship Game - Play</title>
    <link rel="icon" type="image/png" href="images/logo.png">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Ensure Black Ops One loads immediately */
        @import url('https://fonts.googleapis.com/css2?family=Black+Ops+One&display=block');
    </style>
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/style.css?v=2.3">
    <link rel="stylesheet" href="css/game.css?v=2.3">
</head>
<body>
    <div class="game-container">
        <!-- Ship Placement Screen -->
        <div id="placementScreen" class="screen">
            <!-- HUD OVERLAYS (Fixed Position) -->
            <div class="placement-wrapper-hud">
                <!-- YOU Character Card (Top Left) -->
                <div class="deploy-character-card deploy-you hud-you-card">
                    <div class="character-badge badge-you">YOU</div>
                    <div class="character-circle">
                        <img id="deployYourCharacter" src="images/characters/character1/avatar-large.png" alt="Your Character" class="character-avatar">
                    </div>
                    <div class="character-name" id="deployYourName">Player 1</div>
                    <div class="character-status status-waiting" id="deployYourStatus">
                        <span class="status-icon">‚è≥</span>
                        <span>Deploying...</span>
                    </div>
                </div>

                <!-- OPPONENT Character Card (Bottom Right) -->
                <div class="deploy-character-card deploy-opponent hud-opponent-card">
                    <div class="character-badge badge-opponent">OPPONENT</div>
                    <div class="character-circle" id="deployOpponentCircle">
                        <img id="deployOpponentCharacter" src="images/characters/character2/avatar-large.png" alt="Opponent Character" class="character-avatar">
                    </div>
                    <div class="character-name" id="deployOpponentName">Player 2</div>
                    <div class="character-status status-waiting" id="deployOpponentStatus">
                        <span class="status-icon">‚è≥</span>
                        <span>Deploying...</span>
                    </div>
                </div>
            </div>

            <!-- 3-COLUMN GRID LAYOUT -->
            <div class="deploy-layout-grid">
                
                <!-- LEFT COLUMN: Fleet Dock (under YOU card) -->
                <div class="deploy-left-column">
                    <div id="shipDock" class="ship-dock">
                        <div class="dock-header">
                            <h3 class="dock-title">‚öì Fleet</h3>
                            <button id="resetShipsBtn" class="btn-dock-reset" title="Reset all ships">
                                <span>‚Ü∫</span>
                            </button>
                        </div>
                        <div class="dock-ships" id="dockShips">
                            <!-- Ships will be generated by JS -->
                        </div>
                        <div class="dock-footer">
                            <div class="dock-counter">
                                <span id="placedCount">0</span>/<span>5</span> placed
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CENTER COLUMN: Board -->
                <div class="deploy-center-column">
                    <div class="placement-header">
                        <h1 class="deploy-title">Deploy Fleet</h1>
                    </div>

                    <div class="placement-board-container">
                        <div class="board-with-labels">
                            <!-- Header numbers: perfectly aligned with board columns -->
                            <div class="board-labels-top">
                                <div class="label">1</div>
                                <div class="label">2</div>
                                <div class="label">3</div>
                                <div class="label">4</div>
                                <div class="label">5</div>
                                <div class="label">6</div>
                                <div class="label">7</div>
                                <div class="label">8</div>
                                <div class="label">9</div>
                                <div class="label">10</div>
                            </div>
                            
                            <div class="board-with-side-labels">
                                <div class="board-labels-left">
                                    <div class="label">A</div>
                                    <div class="label">B</div>
                                    <div class="label">C</div>
                                    <div class="label">D</div>
                                    <div class="label">E</div>
                                    <div class="label">F</div>
                                    <div class="label">G</div>
                                    <div class="label">H</div>
                                    <div class="label">I</div>
                                    <div class="label">J</div>
                                </div>
                                
                                <div id="placementBoard" class="board board-placement">
                                    <!-- Grid + ships will be generated by JS -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ready Button: centered, outside board panel -->
                    <div class="ready-row">
                        <button id="readyBtn" class="btn btn-primary btn-ready" disabled>
                            <span>‚öì</span>
                            <span>READY!</span>
                        </button>
                    </div>
                </div>

                <!-- RIGHT COLUMN: Control Panel -->
                <div class="deploy-right-column">
                    <!-- Timer outside control panel -->
                    <div class="deploy-timer-standalone">
                        <div class="timer-label">DEPLOYMENT</div>
                        <div class="timer-value" id="deploymentTimer">02:00</div>
                    </div>

                    <div class="deploy-controls-panel">
                        <h3 class="controls-title">‚öôÔ∏è Controls</h3>
                        
                        <!-- Guide Banner -->
                        <div class="placement-guide-banner">
                            <span class="guide-icon">‚ÑπÔ∏è</span>
                            <span class="guide-text">Nh·∫•n <kbd>R</kbd> khi k√©o ƒë·ªÉ xoay t√†u</span>
                        </div>

                        <!-- Random Button -->
                        <button id="randomPlaceBtn" class="btn-rotate btn-control-panel" title="Random t·∫•t c·∫£ t√†u">
                            <span class="rotate-icon">üîÑ</span>
                            <span>Random Fleet</span>
                        </button>
                    </div>
                </div>

            </div><!-- end deploy-layout-grid -->
        </div>

        <!-- gameScreen removed - using battleScreen instead -->

        <!-- Game Over Screen -->
        <div id="gameOverScreen" class="screen" style="display: none;">
            <!-- Image Background -->
            <div class="image-background game-over-bg"></div>
            <div class="game-over-wrapper">
                <!-- Main Card Container - Glassmorphism -->
                <div class="game-over-main-card">
                    <!-- Title -->
                    <div class="game-over-title-container">
                        <h1 id="gameOverTitle" class="game-over-title">B·∫°n ƒë√£ th·∫Øng cu·ªôc!</h1>
                    </div>

                    <!-- VS Badge -->
                    <div class="game-over-vs-badge">VS</div>

                    <!-- Characters Display -->
                    <div class="game-over-characters">
                        <!-- Left: My Character (lu√¥n ·ªü b√™n tr√°i) -->
                        <div class="game-over-character left-character-result">
                            <div class="character-result-portrait">
                                <img id="myCharacterResult" src="" alt="My Character">
                            </div>
                            <div class="character-result-label" id="myResultLabel">Thua</div>
                            <div class="character-result-info">
                                <div class="character-result-name" id="myCharacterName">Captain Storm</div>
                                <div class="character-result-username" id="myPlayerUsername">Player</div>
                            </div>
                        </div>

                        <!-- Right: Opponent Character -->
                        <div class="game-over-character right-character-result">
                            <div class="character-result-portrait">
                                <img id="opponentCharacterResult" src="" alt="Opponent Character">
                            </div>
                            <div class="character-result-label" id="opponentResultLabel">Th·∫Øng</div>
                            <div class="character-result-info">
                                <div class="character-result-name" id="opponentCharacterName">Admiral Wave</div>
                                <div class="character-result-username" id="opponentPlayerUsername">Opponent</div>
                            </div>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="game-over-actions">
                        <button id="backToLobbyBtn" class="btn btn-primary btn-large">
                            <span></span> Back to Hub
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Battle Screen (NEW LAYOUT) -->
        <div id="battleScreen" class="screen" style="display: none;">
            <!-- Background -->
            <div class="battle-background"></div>
            
            <!-- Turn Notification Overlay -->
            <div id="turnTransitionBattle" class="turn-transition" style="display: none;">
                <div class="transition-content">
                    <h1 id="transitionTitleBattle">YOUR TURN</h1>
                </div>
            </div>

            <!-- HIT! Stamp Overlay -->
            <div id="hitStamp" class="hit-stamp" style="display: none;">
                <span>HIT!</span>
            </div>

            <!-- Main Battle Layout -->
            <div class="battle-layout">
                
                <!-- LEFT: Player Banner -->
                <div class="battle-left-banner" id="leftBanner">
                    <div class="player-banner-card">
                        <div class="banner-name" id="leftPlayerName">Player</div>
                        <div class="banner-avatar">
                            <img id="leftPlayerAvatar" src="images/characters/character1/avatar-large.png" alt="You">
                        </div>
                        <div class="banner-status">
                            <span class="status-label">Fleet Status</span>
                            <div class="fleet-health-bar">
                                <div class="health-fill" id="myFleetHealth" style="width: 100%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CENTER: Grids Area -->
                <div class="battle-center">
                    <!-- Top Tabs -->
                    <div class="battle-tabs" id="topTabs">
                        <div class="battle-tab" id="tabFleet">YOUR FLEET</div>
                        <div class="battle-tab active" id="tabTurn">YOUR TURN</div>
                    </div>

                    <!-- Grids Container -->
                    <div class="battle-grids">
                        <!-- Mini Grid (Your Fleet) -->
                        <div class="mini-grid-section">
                            <div class="grid-frame mini-frame">
                                <div class="grid-labels-top mini-labels">
                                    <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
                                    <span>6</span><span>7</span><span>8</span><span>9</span><span>10</span>
                                </div>
                                <div class="grid-with-left-labels">
                                    <div class="grid-labels-left mini-labels">
                                        <span>A</span><span>B</span><span>C</span><span>D</span><span>E</span>
                                        <span>F</span><span>G</span><span>H</span><span>I</span><span>J</span>
                                    </div>
                                    <div id="battleMyBoard" class="battle-grid mini-grid"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Main Grid (Opponent - Target) -->
                        <div class="main-grid-section">
                            <div class="grid-frame main-frame">
                                <div class="grid-labels-top main-labels">
                                    <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
                                    <span>6</span><span>7</span><span>8</span><span>9</span><span>10</span>
                                </div>
                                <div class="grid-with-left-labels">
                                    <div class="grid-labels-left main-labels">
                                        <span>A</span><span>B</span><span>C</span><span>D</span><span>E</span>
                                        <span>F</span><span>G</span><span>H</span><span>I</span><span>J</span>
                                    </div>
                                    <div id="battleEnemyBoard" class="battle-grid main-grid"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- RIGHT: Timer + Tracker -->
                <div class="battle-right-panel">
                    <!-- Timer -->
                    <div class="battle-timer-box">
                        <div class="timer-circle">
                            <span id="battleTimer" class="timer-value">60</span>
                        </div>
                        <span class="timer-label-text">SECONDS</span>
                    </div>

                    <!-- Ship Tracker -->
                    <div class="ship-tracker" id="rightTracker">
                        <div class="tracker-title">Enemy Ships</div>
                        <div class="tracker-ships">
                            <div class="tracker-ship" data-ship="carrier">
                                <span class="ship-icon">üö¢</span>
                                <span class="ship-name">Carrier</span>
                                <span class="ship-status">‚óè‚óè‚óè‚óè‚óè</span>
                            </div>
                            <div class="tracker-ship" data-ship="battleship">
                                <span class="ship-icon">‚õ¥Ô∏è</span>
                                <span class="ship-name">Battleship</span>
                                <span class="ship-status">‚óè‚óè‚óè‚óè</span>
                            </div>
                            <div class="tracker-ship" data-ship="cruiser">
                                <span class="ship-icon">üö§</span>
                                <span class="ship-name">Cruiser</span>
                                <span class="ship-status">‚óè‚óè‚óè</span>
                            </div>
                            <div class="tracker-ship" data-ship="submarine">
                                <span class="ship-icon">üî±</span>
                                <span class="ship-name">Submarine</span>
                                <span class="ship-status">‚óè‚óè‚óè</span>
                            </div>
                            <div class="tracker-ship" data-ship="destroyer">
                                <span class="ship-icon">‚öì</span>
                                <span class="ship-name">Destroyer</span>
                                <span class="ship-status">‚óè‚óè</span>
                            </div>
                        </div>
                    </div>

                    <!-- Opponent Card -->
                    <div class="opponent-card" id="opponentCard">
                        <div class="opponent-avatar">
                            <img id="opponentAvatar" src="images/characters/character2/avatar-large.png" alt="Opponent">
                        </div>
                        <div class="opponent-name" id="opponentName">Opponent</div>
                    </div>

                    <!-- Shot History -->
                    <div class="shot-history">
                        <div class="shot-history-title">Shot History</div>
                        <div class="shot-history-list" id="shotHistoryList"></div>
                    </div>
                </div>

            </div><!-- end battle-layout -->

            <!-- Chat Bubble (Facebook Messenger style) -->
            <div class="chat-bubble" id="chatBubble">
                <span class="bubble-icon">üí¨</span>
                <span class="bubble-badge" id="chatBadge" style="display: none;">0</span>
            </div>

            <!-- Chat/Video Popup Panel -->
            <div class="chat-popup" id="chatPopup" style="display: none;">
                <div class="popup-header">
                    <span class="popup-title">Chat & Video</span>
                    <button class="popup-close" id="closeChatPopup">‚úï</button>
                </div>
                
                <!-- Video Section -->
                <div class="popup-video-section">
                    <div class="video-container">
                        <video id="battleRemoteVideo" autoplay playsinline></video>
                        <video id="battleLocalVideo" autoplay playsinline muted class="local-video"></video>
                    </div>
                    <div class="video-controls">
                        <button id="battleStartCallBtn" class="btn-call" title="Start Call">üìû Call</button>
                        <button id="battleEndCallBtn" class="btn-call btn-end" style="display: none;" title="End Call">üìû End</button>
                        <button id="battleToggleVideoBtn" class="btn-toggle" title="Toggle Camera">üìπ</button>
                        <button id="battleToggleAudioBtn" class="btn-toggle" title="Toggle Mic">üé§</button>
                    </div>
                </div>

                <!-- Chat Section -->
                <div class="popup-chat-section">
                    <div id="battleChatMessages" class="popup-chat-messages"></div>
                    <div class="popup-chat-input">
                        <input type="text" id="battleChatInput" placeholder="Type a message..." maxlength="200">
                        <button id="battleChatSend" class="btn-chat-send">‚û§</button>
                    </div>
                </div>
            </div>

            <!-- Settings Button -->
            <button class="btn-settings" id="btnSettings" title="Settings">‚öôÔ∏è</button>
            <div class="settings-menu" id="settingsMenu" aria-hidden="true">
                <button id="exitToHubBtn" class="settings-item" onclick="backToHub()">Tho√°t game</button>
            </div>

        </div><!-- end battleScreen -->
    </div>

    <!-- Socket.IO -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/charactersData.js"></script>
    <script src="js/shipDock.js"></script>
    <script src="js/shared/state.js"></script>
    <script src="js/shared/socket-shared.js"></script>
    <script src="js/game.js?v=2.5"></script>
    <!-- ui.js removed - logic consolidated into game.js -->
    <!-- socket.js is deprecated - using socket-shared.js instead -->
    <script src="js/chat.js"></script>
    <script src="js/webrtc.js"></script>
    <!-- battle.js removed - logic consolidated into game.js -->
</body>
</html>






